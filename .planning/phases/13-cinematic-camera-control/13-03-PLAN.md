---
phase: 13-cinematic-camera-control
plan: 03
type: execute
wave: 2
depends_on: ["13-01", "13-02"]
files_modified:
  - src/client/java/com/dread/client/DeathCinematicClientHandler.java
autonomous: false

must_haves:
  truths:
    - "Camera pulls back correctly for all 3 Dread forms (BASE, EVOLVED, ELDRITCH)"
    - "Face close-up fills screen with Dread's face for all forms"
    - "Eyes are centered in frame during close-up"
    - "Jump cut is jarring, not smooth"
    - "Letterbox bars appear at correct time"
    - "Death sequence completes in 4.5 seconds"
  artifacts:
    - path: "src/client/java/com/dread/client/DeathCinematicClientHandler.java"
      provides: "Tuned camera parameters for all Dread forms"
      contains: "FACE_DISTANCE"
  key_links:
    - from: "DeathCinematicClientHandler.java"
      to: "Entity.getEyePos()"
      via: "Eye position calculation for face targeting"
      pattern: "getEyePos\\(\\)"
---

<objective>
Tune camera parameters, integrate components, and verify cinematic quality across all Dread forms.

Purpose: Ensure the death cinematic delivers genuine horror through properly tuned camera positioning, timing, and visual consistency. The face close-up must be overwhelming, the pull-back must frame both characters, and the jump cut must be jarring.

Output: Polished, tested cinematic camera system ready for Phase 14 (texture animation).
</objective>

<execution_context>
@C:\Users\dylan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dylan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-cinematic-camera-control/13-CONTEXT.md
@.planning/phases/13-cinematic-camera-control/13-RESEARCH.md
@.planning/phases/13-cinematic-camera-control/13-01-SUMMARY.md
@.planning/phases/13-cinematic-camera-control/13-02-SUMMARY.md
@src/client/java/com/dread/client/DeathCinematicClientHandler.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add camera rotation control for face close-up</name>
  <files>src/client/java/com/dread/client/DeathCinematicClientHandler.java</files>
  <action>
During FACE_CLOSEUP phase, the camera must look AT Dread's eyes, not just be positioned near them. Add camera rotation calculation.

In calculateFaceCloseupPosition() or a new method getCameraRotationOverride():
1. Calculate direction from camera position to Dread's eye position
2. Convert direction to yaw/pitch
3. During FACE_CLOSEUP phase, override player rotation to look at Dread

Add method:
```java
/**
 * Get camera rotation to look at Dread's eyes during face close-up.
 * Returns null if not in face close-up phase.
 */
public static float[] getFaceCloseupRotation() {
    if (!cinematicActive || currentPhase != CinematicPhase.FACE_CLOSEUP) {
        return null;
    }

    MinecraftClient client = MinecraftClient.getInstance();
    if (client.player == null || client.world == null) return null;

    Entity dread = client.world.getEntityById(dreadEntityId);
    if (dread == null) return null;

    // Camera looks FROM close-up position TO Dread's eyes
    Vec3d cameraPos = client.player.getEyePos().add(getCameraPositionOffset());
    Vec3d dreadEyes = dread.getEyePos();
    Vec3d direction = dreadEyes.subtract(cameraPos).normalize();

    // Convert to yaw/pitch
    float yaw = (float) Math.toDegrees(Math.atan2(-direction.x, direction.z));
    float pitch = (float) Math.toDegrees(-Math.asin(direction.y));

    return new float[]{yaw, pitch};
}
```

Update tick() method to apply this rotation during FACE_CLOSEUP phase instead of the existing smooth lerp tracking. During face close-up, the view should be LOCKED still (frozen terror aesthetic per CONTEXT.md).

During THIRD_PERSON_PULLBACK phase, keep existing smooth yaw tracking to Dread (looking at Dread during pull-back is correct).
  </action>
  <verify>
`grep -c "getFaceCloseupRotation" src/client/java/com/dread/client/DeathCinematicClientHandler.java` returns 1 or more.
`grep "public static float\[\] getFaceCloseupRotation" src/client/java/com/dread/client/DeathCinematicClientHandler.java` shows method signature.
Build compiles with `gradlew build`.
  </verify>
  <done>
Camera rotation is locked on Dread's eyes during face close-up phase, creating frozen terror aesthetic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify timing and phase transitions</name>
  <files>src/client/java/com/dread/client/DeathCinematicClientHandler.java</files>
  <action>
Add debug logging (temporary) to verify timing during development:

1. In updatePhase(), log phase transitions:
```java
if (previousPhase != currentPhase) {
    LOGGER.debug("Cinematic phase transition: {} -> {} at tick {}",
        previousPhase, currentPhase, cinematicTimer);
}
```

2. In endCinematic(), log total duration:
```java
LOGGER.debug("Cinematic ended after {} ticks ({} seconds)",
    cinematicTimer, cinematicTimer / 20.0f);
```

Add private static field to track previousPhase for transition logging:
```java
private static CinematicPhase previousPhase = null;
```

Verify:
- THIRD_PERSON_PULLBACK runs from tick 0-30 (1.5 seconds)
- FACE_CLOSEUP runs from tick 30-90 (3.0 seconds)
- Total duration is exactly 90 ticks (4.5 seconds)
- Transition at tick 30 is instant (no interpolation - jump cut)

The debug logging can be removed after verification or left at DEBUG level.
  </action>
  <verify>
Build compiles with logging statements.
Phase transitions occur at correct tick boundaries.
Total duration is 4.5 seconds (90 ticks).
  </verify>
  <done>
Phase timing verified: 1.5s pull-back + 3.0s face close-up = 4.5s total. Jump cut is instant at tick 30.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete cinematic camera system with:
- Third-person pull-back phase (1.5s) framing player and Dread
- Instant jump cut to face close-up
- Face close-up phase (3s) with Dread's eyes centered
- Letterbox bars appearing instantly
- No camera shake (frozen terror aesthetic)
  </what-built>
  <how-to-verify>
1. Launch game in development mode: `./gradlew runClient`

2. Spawn Dread behind player (turn around to trigger):
   - Command: `/summon dread:dread ~ ~ ~-3` (spawns 3 blocks behind)
   - Or use in-game spawn mechanics

3. Let Dread kill player and observe death cinematic:

**Pull-back phase (first 1.5 seconds):**
- [ ] Camera instantly jumps to third-person (no smooth transition from first-person)
- [ ] Camera is behind and above player (about 5 blocks back, 2 up)
- [ ] Both player and Dread visible in frame (size difference emphasized)
- [ ] Letterbox bars appear immediately at top and bottom (60 pixels)

**Jump cut (at 1.5 second mark):**
- [ ] Camera instantly snaps to face close-up (jarring, not smooth)
- [ ] No interpolation or transition animation

**Face close-up phase (remaining 3 seconds):**
- [ ] Dread's face fills screen edge-to-edge
- [ ] Eyes are centered in frame (direct eye contact)
- [ ] Camera is completely still (no drift, sway, or shake)
- [ ] Letterbox bars remain visible

**General:**
- [ ] Total duration is 4.5 seconds
- [ ] No FPS drops or stuttering
- [ ] Cinematic ends cleanly, player enters downed state

4. Test with all 3 Dread forms if possible:
   - BASE form: `/summon dread:dread ~ ~ ~-3`
   - EVOLVED form: (after sufficient gameplay or config)
   - ELDRITCH form: (after sufficient gameplay or config)

5. Verify form consistency:
- [ ] Eyes centered for all forms (different heights handled by getEyePos())
- [ ] Face fills screen similarly for all forms
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues with specific phase/timing for tuning.</resume-signal>
</task>

</tasks>

<verification>
1. Camera position changes at correct phases
2. Rotation locks during face close-up (no movement)
3. Jump cut is instant (no interpolation)
4. Letterbox bars visible throughout cinematic
5. Total duration is 4.5 seconds
6. All 3 Dread forms work correctly
7. No performance issues at 144Hz
</verification>

<success_criteria>
- Pull-back phase frames both player and Dread (shows size difference)
- Face close-up is overwhelming (fills screen, eyes centered)
- Jump cut is jarring (instant transition, horror aesthetic)
- Letterbox bars signal cinematic mode throughout
- Camera is frozen during close-up (no shake, drift, or movement)
- All 3 Dread forms display correctly
- Cinematic maintains 60+ FPS on target hardware
- Human verification confirms horror impact
</success_criteria>

<output>
After completion, create `.planning/phases/13-cinematic-camera-control/13-03-SUMMARY.md`
</output>
