---
phase: 13-cinematic-camera-control
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/client/java/com/dread/client/CinematicLetterboxRenderer.java
  - src/client/java/com/dread/DreadClient.java
autonomous: true

must_haves:
  truths:
    - "Black letterbox bars appear instantly when death sequence starts"
    - "Letterbox bars cover top and bottom of screen"
    - "Bars disappear when cinematic ends"
    - "Bars render on top of game content (not behind)"
  artifacts:
    - path: "src/client/java/com/dread/client/CinematicLetterboxRenderer.java"
      provides: "HUD overlay rendering letterbox bars during cinematic"
      contains: "HudRenderCallback"
    - path: "src/client/java/com/dread/DreadClient.java"
      provides: "Registration of letterbox renderer"
      contains: "CinematicLetterboxRenderer.register()"
  key_links:
    - from: "CinematicLetterboxRenderer.java"
      to: "DeathCinematicClientHandler.isCinematicActive()"
      via: "Visibility check in render callback"
      pattern: "DeathCinematicClientHandler\\.isCinematicActive\\(\\)"
---

<objective>
Implement letterbox bars that signal cinematic mode to the player.

Purpose: Visual feedback that player has lost camera control. Black bars at top and bottom of screen create cinematic film aesthetic and reinforce the horror of being trapped in the death sequence.

Output: CinematicLetterboxRenderer that renders instant-appearing black bars during death cinematic.
</objective>

<execution_context>
@C:\Users\dylan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dylan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-cinematic-camera-control/13-CONTEXT.md
@.planning/phases/13-cinematic-camera-control/13-RESEARCH.md
@src/client/java/com/dread/client/DownedHudOverlay.java
@src/client/java/com/dread/DreadClient.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CinematicLetterboxRenderer</name>
  <files>src/client/java/com/dread/client/CinematicLetterboxRenderer.java</files>
  <action>
Create new file CinematicLetterboxRenderer.java in src/client/java/com/dread/client/.

Follow DownedHudOverlay.java pattern for HudRenderCallback registration.

Implementation:
```java
package com.dread.client;

import net.fabricmc.fabric.api.client.rendering.v1.HudRenderCallback;
import net.minecraft.client.MinecraftClient;
import net.minecraft.client.gui.DrawContext;
import net.minecraft.client.render.RenderTickCounter;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Renders letterbox bars during death cinematic.
 * Bars appear instantly (no fade) to signal player control loss.
 * Creates cinematic film aesthetic that reinforces horror.
 */
public class CinematicLetterboxRenderer {
    private static final Logger LOGGER = LoggerFactory.getLogger("dread-client");

    // Bar configuration
    private static final int BAR_HEIGHT = 60; // pixels (works for 720p-2160p)
    private static final int BAR_COLOR = 0xFF000000; // Solid black, full opacity

    /**
     * Register the letterbox renderer with Fabric HUD callback.
     * Called during client initialization.
     */
    public static void register() {
        HudRenderCallback.EVENT.register(CinematicLetterboxRenderer::render);
        LOGGER.info("Registered CinematicLetterboxRenderer");
    }

    /**
     * Render letterbox bars if cinematic is active.
     * Bars are solid black, instant appearance, no animation.
     */
    private static void render(DrawContext context, RenderTickCounter tickCounter) {
        if (!DeathCinematicClientHandler.isCinematicActive()) {
            return;
        }

        MinecraftClient client = MinecraftClient.getInstance();
        int width = client.getWindow().getScaledWidth();
        int height = client.getWindow().getScaledHeight();

        // Top letterbox bar (solid black, instant appearance)
        context.fill(0, 0, width, BAR_HEIGHT, BAR_COLOR);

        // Bottom letterbox bar (solid black, instant appearance)
        context.fill(0, height - BAR_HEIGHT, width, height, BAR_COLOR);
    }
}
```

Key points:
- BAR_HEIGHT = 60 pixels (per RESEARCH.md recommendation for 720p-2160p)
- BAR_COLOR = 0xFF000000 (solid black, no transparency per CONTEXT.md)
- No fade animation - bars snap in instantly when isCinematicActive() returns true
- Uses DrawContext.fill() same as DownedHudOverlay uses drawText()
  </action>
  <verify>
File exists at src/client/java/com/dread/client/CinematicLetterboxRenderer.java.
Contains register() method with HudRenderCallback.EVENT.register().
Contains render() method checking DeathCinematicClientHandler.isCinematicActive().
  </verify>
  <done>
CinematicLetterboxRenderer renders 60-pixel black bars at top and bottom of screen during death cinematic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Register letterbox renderer in DreadClient</name>
  <files>src/client/java/com/dread/DreadClient.java</files>
  <action>
Add import for CinematicLetterboxRenderer (already in same package, but explicit import for clarity).

In onInitializeClient() method, add registration call after CinematicCompensationRenderer:
```java
// Register cinematic letterbox renderer (Phase 13)
CinematicLetterboxRenderer.register();
```

Place this near other HUD renderer registrations (DownedHudOverlay, CrawlVignetteRenderer, CinematicCompensationRenderer, RevivalProgressRenderer).
  </action>
  <verify>
DreadClient.java contains "CinematicLetterboxRenderer.register()" call.
Build compiles successfully.
  </verify>
  <done>
CinematicLetterboxRenderer registered in client initialization, will render during death cinematic.
  </done>
</task>

<task type="auto">
  <name>Task 3: Build and verify registration</name>
  <files>src/client/java/com/dread/client/CinematicLetterboxRenderer.java, src/client/java/com/dread/DreadClient.java</files>
  <action>
Run full build to verify:
```bash
export JAVA_HOME="X:/Vibe Coding/jdk-21.0.6+7"
./gradlew build
```

Check:
1. CinematicLetterboxRenderer compiles without errors
2. DreadClient compiles with new registration
3. No missing import warnings

If build fails, verify:
- Package declaration matches directory structure
- All imports present (DrawContext, RenderTickCounter, etc.)
- Logger name matches pattern used in other files
  </action>
  <verify>
`gradlew build` completes with BUILD SUCCESSFUL.
No compilation errors related to CinematicLetterboxRenderer.
  </verify>
  <done>
Build passes. CinematicLetterboxRenderer is registered and will render letterbox bars during death cinematic.
  </done>
</task>

</tasks>

<verification>
1. Build completes successfully with `gradlew build`
2. CinematicLetterboxRenderer.java exists with register() and render() methods
3. DreadClient.java contains CinematicLetterboxRenderer.register() call
4. BAR_HEIGHT = 60, BAR_COLOR = 0xFF000000 (solid black)
5. No fade animation - instant appearance
</verification>

<success_criteria>
- CinematicLetterboxRenderer renders 60-pixel black bars at top and bottom
- Bars appear instantly when DeathCinematicClientHandler.isCinematicActive() returns true
- Bars disappear instantly when cinematic ends
- No fade animation (per CONTEXT.md "Bars snap in instantly with control loss")
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-cinematic-camera-control/13-02-SUMMARY.md`
</output>
