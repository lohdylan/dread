---
phase: 03-death-revival-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - build.gradle
  - src/main/java/com/dread/sound/ModSounds.java
  - src/main/java/com/dread/network/DreadNetworking.java
  - src/main/java/com/dread/network/packets/CinematicTriggerS2C.java
  - src/main/java/com/dread/network/packets/DownedStateUpdateS2C.java
  - src/main/java/com/dread/network/packets/RevivalProgressS2C.java
  - src/main/java/com/dread/network/packets/RemoveDownedEffectsS2C.java
  - src/main/resources/assets/dread/sounds.json
autonomous: true

must_haves:
  truths:
    - "Death sequence audio files exist and are registered"
    - "Network packets can be sent from server to client"
    - "Satin API is available for shader effects"
  artifacts:
    - path: "build.gradle"
      provides: "Satin API dependency"
      contains: "satin"
    - path: "src/main/java/com/dread/network/DreadNetworking.java"
      provides: "Packet registration hub"
      exports: ["registerPackets"]
    - path: "src/main/java/com/dread/network/packets/CinematicTriggerS2C.java"
      provides: "S2C packet to trigger death cinematic on client"
      exports: ["ID", "CODEC"]
    - path: "src/main/java/com/dread/sound/ModSounds.java"
      provides: "Death audio sound event"
      contains: "DREAD_DEATH"
  key_links:
    - from: "DreadMod.java"
      to: "DreadNetworking.registerPackets()"
      via: "onInitialize() call"
      pattern: "DreadNetworking\\.register"
    - from: "sounds.json"
      to: "ModSounds.DREAD_DEATH"
      via: "sound event registration"
      pattern: "dread_death"
---

<objective>
Add Satin API dependency for post-processing shaders, register death sequence audio, and define network packets for death/revival synchronization.

Purpose: Establish foundation for client-server communication and visual effects required by death cinematic and downed state rendering.

Output:
- Satin API available in project dependencies
- DREAD_DEATH sound event registered with placeholder audio
- Four S2C packet types defined for cinematic trigger, downed state sync, revival progress, and effect removal
</objective>

<execution_context>
@C:\Users\dylan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dylan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-death-revival-system/03-RESEARCH.md

# Prior plan references (for patterns)
@.planning/phases/02-ai-horror-experience/02-01-SUMMARY.md
@.planning/phases/01-foundation-entity/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Satin API dependency and death sound registration</name>
  <files>
    build.gradle
    src/main/java/com/dread/sound/ModSounds.java
    src/main/resources/assets/dread/sounds.json
    src/main/resources/assets/dread/sounds/dread_death.ogg
  </files>
  <action>
    1. Add Satin API to build.gradle dependencies:
       ```gradle
       modImplementation "maven.modrinth:satin:mc1.21-1.17.0"
       ```
       Add Modrinth Maven repository if not present:
       ```gradle
       maven {
           name = 'Modrinth'
           url = 'https://api.modrinth.com/maven'
       }
       ```

    2. Add DREAD_DEATH sound event to ModSounds.java following existing pattern (DREAD_JUMPSCARE, etc.):
       ```java
       public static final SoundEvent DREAD_DEATH = registerSound("dread_death");
       ```

    3. Update sounds.json to include dread_death entry:
       ```json
       "dread_death": {
         "category": "hostile",
         "sounds": [
           {
             "name": "dread:dread_death",
             "stream": false
           }
         ]
       }
       ```

    4. Create placeholder death sound (5 seconds of silence in mono OGG format, 44100 Hz).
       Use ffmpeg to generate placeholder:
       ```bash
       ffmpeg -f lavfi -i anullsrc=r=44100:cl=mono -t 5 -c:a libvorbis src/main/resources/assets/dread/sounds/dread_death.ogg
       ```
       Note: Placeholder to be replaced with actual death audio asset later.
  </action>
  <verify>
    Run `./gradlew build` with JAVA_HOME set to verify Satin dependency resolves and mod compiles.
    Verify sounds.json is valid JSON.
  </verify>
  <done>
    - Satin API dependency added to build.gradle
    - DREAD_DEATH sound event registered in ModSounds.java
    - sounds.json includes dread_death entry
    - Placeholder audio file exists
    - Build succeeds with new dependency
  </done>
</task>

<task type="auto">
  <name>Task 2: Create network packet definitions for death/revival sync</name>
  <files>
    src/main/java/com/dread/network/DreadNetworking.java
    src/main/java/com/dread/network/packets/CinematicTriggerS2C.java
    src/main/java/com/dread/network/packets/DownedStateUpdateS2C.java
    src/main/java/com/dread/network/packets/RevivalProgressS2C.java
    src/main/java/com/dread/network/packets/RemoveDownedEffectsS2C.java
    src/main/java/com/dread/DreadMod.java
  </files>
  <action>
    1. Create network package structure under src/main/java/com/dread/network/

    2. Create CinematicTriggerS2C.java - triggers death cinematic on client:
       ```java
       public record CinematicTriggerS2C(int dreadEntityId, BlockPos deathPos) implements CustomPayload {
           public static final CustomPayload.Id<CinematicTriggerS2C> ID =
               new CustomPayload.Id<>(Identifier.of("dread", "cinematic_trigger"));

           public static final PacketCodec<RegistryByteBuf, CinematicTriggerS2C> CODEC =
               PacketCodec.tuple(
                   PacketCodecs.VAR_INT, CinematicTriggerS2C::dreadEntityId,
                   BlockPos.PACKET_CODEC, CinematicTriggerS2C::deathPos,
                   CinematicTriggerS2C::new
               );

           @Override
           public Id<? extends CustomPayload> getId() { return ID; }
       }
       ```

    3. Create DownedStateUpdateS2C.java - syncs downed state to client:
       ```java
       public record DownedStateUpdateS2C(boolean isDowned, int remainingSeconds) implements CustomPayload {
           // Same pattern with ID and CODEC
       }
       ```

    4. Create RevivalProgressS2C.java - shows revival progress bar:
       ```java
       public record RevivalProgressS2C(UUID downedPlayerUUID, boolean active, float progress) implements CustomPayload {
           // Same pattern - progress is 0.0 to 1.0
       }
       ```

    5. Create RemoveDownedEffectsS2C.java - clears shaders on revival/respawn:
       ```java
       public record RemoveDownedEffectsS2C() implements CustomPayload {
           // Simple packet with no data, just signals effect removal
       }
       ```

    6. Create DreadNetworking.java hub class:
       ```java
       public class DreadNetworking {
           public static void registerPackets() {
               // Register S2C payloads
               PayloadTypeRegistry.playS2C().register(CinematicTriggerS2C.ID, CinematicTriggerS2C.CODEC);
               PayloadTypeRegistry.playS2C().register(DownedStateUpdateS2C.ID, DownedStateUpdateS2C.CODEC);
               PayloadTypeRegistry.playS2C().register(RevivalProgressS2C.ID, RevivalProgressS2C.CODEC);
               PayloadTypeRegistry.playS2C().register(RemoveDownedEffectsS2C.ID, RemoveDownedEffectsS2C.CODEC);
           }
       }
       ```

    7. Call DreadNetworking.registerPackets() from DreadMod.onInitialize() after existing registrations.

    Note: Client-side receivers will be registered in Plan 03-04 when shader effects are implemented.
  </action>
  <verify>
    Run `./gradlew build` to verify all packet classes compile correctly.
    Check that DreadMod.java calls DreadNetworking.registerPackets().
  </verify>
  <done>
    - All four S2C packet classes created with proper ID and CODEC
    - DreadNetworking.java registers all packets with PayloadTypeRegistry
    - DreadMod.onInitialize() calls DreadNetworking.registerPackets()
    - Build succeeds
  </done>
</task>

</tasks>

<verification>
1. Run full build: `JAVA_HOME="X:/Vibe Coding/jdk-21.0.6+7" ./gradlew build`
2. Verify Satin API dependency resolves (check build output for satin download)
3. Verify no compilation errors in network package
4. Verify sounds.json is valid JSON with dread_death entry
5. Verify DreadMod.java initializes networking
</verification>

<success_criteria>
- Build succeeds with Satin API and all new classes
- DREAD_DEATH sound event is registered and has placeholder audio
- Four S2C packet types are defined and registered
- DreadNetworking.registerPackets() called during mod initialization
</success_criteria>

<output>
After completion, create `.planning/phases/03-death-revival-system/03-01-SUMMARY.md`
</output>
