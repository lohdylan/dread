---
phase: 08-cinematic-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/resources/assets/dread/animations/dread_entity.animation.json
  - src/main/java/com/dread/entity/DreadEntity.java
  - src/main/java/com/dread/sound/ModSounds.java
autonomous: true

must_haves:
  truths:
    - "Dread has new 1.8s death_grab animation distinct from 0.8s attack"
    - "Death grab animation plays during death cinematic"
    - "Sound keyframes in animation JSON define audio timing"
  artifacts:
    - path: "src/main/resources/assets/dread/animations/dread_entity.animation.json"
      provides: "death_grab animation with sound_effects keyframes"
      contains: "death_grab"
    - path: "src/main/java/com/dread/entity/DreadEntity.java"
      provides: "Animation controller for death_grab"
      contains: "death_grab"
    - path: "src/main/java/com/dread/sound/ModSounds.java"
      provides: "GRAB_IMPACT sound event registration"
      contains: "GRAB_IMPACT"
  key_links:
    - from: "dread_entity.animation.json"
      to: "DreadEntity.registerControllers()"
      via: "GeckoLib animation name string"
      pattern: "death_grab"
---

<objective>
Create extended death grab animation (1.8s) with front-loaded violence pacing and GeckoLib sound keyframes for audio synchronization.

Purpose: Replace the quick 0.8s attack animation during death cinematic with an intense, terrifying grab sequence that fills the screen with cosmic horror.

Output: New death_grab animation in JSON, DreadEntity animation controller for cinematic, GRAB_IMPACT sound registration.
</objective>

<execution_context>
@C:\Users\dylan\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dylan\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-cinematic-enhancement/08-RESEARCH.md
@.planning/phases/08-cinematic-enhancement/08-CONTEXT.md
@src/main/resources/assets/dread/animations/dread_entity.animation.json
@src/main/java/com/dread/entity/DreadEntity.java
@src/main/java/com/dread/sound/ModSounds.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create death_grab animation with sound keyframes</name>
  <files>src/main/resources/assets/dread/animations/dread_entity.animation.json</files>
  <action>
Add a new "death_grab" animation to the animations object with these specifications:

Animation timing (1.8 seconds total, front-loaded violence):
- 0.0-0.15s: Explosive lunge forward (body position 0 to +12 on Z axis)
- 0.15-1.0s: Hold at maximum extension (arms wrapped around, entity fills view)
- 1.0-1.8s: Return to neutral (release and pull back)

Bone keyframes:
- body.position: [0,0,0] at 0.0 -> [0,0,12] at 0.15 -> hold -> [0,0,0] at 1.8
- left_arm.rotation: [0,0,0] at 0.0 -> [-100,0,-60] at 0.15 (grabbing pose) -> hold -> [0,0,0] at 1.8
- right_arm.rotation: [0,0,0] at 0.0 -> [-100,0,60] at 0.15 (grabbing pose) -> hold -> [0,0,0] at 1.8
- head.rotation: [-15,0,0] throughout hold phase (looking down at prey)
- face_tentacles.rotation: [25,0,0] during hold (reaching toward victim)
- left_arm_tentacles.rotation: [35,0,30] during hold
- right_arm_tentacles.rotation: [35,0,-30] during hold

Sound keyframes (GeckoLib 4 format):
```json
"sound_effects": {
  "0.0": {
    "effect": "dread:grab_impact"
  }
}
```

Keep existing "attack" animation unchanged at 0.8s - it's used for normal melee attacks.
  </action>
  <verify>
Open the JSON file and verify:
1. "death_grab" animation exists with animation_length: 1.8
2. sound_effects object exists with 0.0 timestamp
3. "attack" animation unchanged at 0.8s
  </verify>
  <done>
death_grab animation exists in JSON with 1.8s duration, front-loaded violence timing, and sound keyframe at 0.0s
  </done>
</task>

<task type="auto">
  <name>Task 2: Register GRAB_IMPACT sound event</name>
  <files>src/main/java/com/dread/sound/ModSounds.java</files>
  <action>
Add a new sound event registration for the grab impact sound that plays at cinematic start:

```java
// Grab impact sound for death cinematic start
public static final SoundEvent GRAB_IMPACT = registerSound("grab_impact");
```

Add this after the existing DREAD_DEATH sound registration.

Note: The actual audio file will be provided by Phase 5 (Resources). This registers the sound event for the keyframe to reference.
  </action>
  <verify>
Verify ModSounds.java contains GRAB_IMPACT sound event registration.
  </verify>
  <done>
GRAB_IMPACT sound event registered and available for GeckoLib sound keyframes
  </done>
</task>

<task type="auto">
  <name>Task 3: Add death_grab animation controller to DreadEntity</name>
  <files>src/main/java/com/dread/entity/DreadEntity.java</files>
  <action>
Add a new animation controller specifically for the death grab animation. This controller will be triggered by the cinematic system.

1. Add a field to track cinematic state:
```java
private boolean isPlayingDeathGrab = false;
```

2. Add getter/setter methods:
```java
public boolean isPlayingDeathGrab() {
    return this.isPlayingDeathGrab;
}

public void setPlayingDeathGrab(boolean playing) {
    this.isPlayingDeathGrab = playing;
}
```

3. In registerControllers(), modify the "main" controller to check for death grab FIRST (before other animations):
```java
// In the main controller state logic, add at the TOP (highest priority):
if (this.isPlayingDeathGrab) {
    return state.setAndContinue(RawAnimation.begin().thenPlay("death_grab"));
}
```

4. Add AutoPlayingSoundKeyframeHandler to the main controller for sound keyframe support:
```java
// After creating the controller, add:
.setSoundKeyframeHandler(new software.bernie.geckolib.animation.keyframe.event.AutoPlayingSoundKeyframeHandler<>())
```

The death grab animation will be triggered when setPlayingDeathGrab(true) is called from the cinematic trigger. After 1.8s (36 ticks), the cinematic handler will set it back to false.
  </action>
  <verify>
Verify DreadEntity.java:
1. Contains isPlayingDeathGrab field and getter/setter
2. Main controller checks isPlayingDeathGrab before other animations
3. AutoPlayingSoundKeyframeHandler is set on the controller
  </verify>
  <done>
DreadEntity plays death_grab animation when isPlayingDeathGrab flag is true, with automatic sound keyframe handling
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Build the project:
```bash
export JAVA_HOME="X:/Vibe Coding/jdk-21.0.6+7" && ./gradlew build
```

2. Verify animation JSON is valid JSON (no syntax errors in build)

3. Verify DreadEntity compiles without errors

4. Verify sound registration compiles without errors
</verification>

<success_criteria>
- Build succeeds without errors
- death_grab animation defined in JSON with 1.8s duration
- Animation has sound_effects keyframe at 0.0s for grab_impact
- DreadEntity has isPlayingDeathGrab flag and animation controller logic
- Existing attack animation unchanged (still 0.8s for normal melee)
</success_criteria>

<output>
After completion, create `.planning/phases/08-cinematic-enhancement/08-01-SUMMARY.md`
</output>
